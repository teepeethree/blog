---
author: tpotts
pubDatetime: 2023-11-14T00:00:00Z
title: Study Journal 14-11-2023
slug: sj-20231114
featured: false
draft: false
tags:
  - study-journal
description: Study Journal entry for 14-11-2023
---
# SJE # 2023-11-14

## Random thoughts to checkout

## From “Pragmatic Thinking and Learning”

## Portal - Development

### Onward - Finishing up the Stocktake Form - Initialisation, Completion and Submission

Status update - **update in bold (14 / 11 / 2023)**

1.  Initialisation - nearly complete - **done**
2.  Completion - about halfway - **underway**
3.  Submission - not much progress -- have psuedocode for submission logic

Tasks for completion for today:

- Finish off initialisation - this is the requirements:
  - Allows user to use the button on the right conditions - **done**
    - Understands the context - by calculating the week and reading the database for existing records. - **done**
    - For the future - getting context from a custom claim JWT (Auth token) - that will be how we determine the users associated location, role, etc. - **later**
  - When pressed it does three actions:
    - Writes a new blank stocktake - **done**
    - Opens the stocktake widget - **done**
    - Locks the stocktake for the other user **\- done and also allows resumption of incomplete stocktakes**

### **Onto Stocktake Management Proper - Figuring out Stock Item, and Stock Count state management.**

**General Flow of State Management for Stock Item and Stock Counts**

**Item**

**Stock Item**

**Stock Count**

Models - Object

class StockItem {

String stockItemId; **required**

String productId; **// This is really a concrete SKU, not a relational ID**

String name; **required**

String description; **required**

bool isSelected = false;

class StockCount {

int quantity; **required** **// Matches to the "newQuantity" in the Adjustment model**

int lastCount; **// Matches to the "oldQuantity" in the Adjustment model**

bool hasChanged = false;

Models - Methods

- To = JSON
- From = fromFirestore factory method

- To = JSON
- From = JSON

State - Object

class StockItemState {

final List<StockItem> stockItems;

final bool isLoading;

final String? error;

class CountState {

final int quantity;

final int lastCount;

final bool hasChanged;

State - Methods

- copyWith method

- copyWith method

Notifiers - Object

class StockItemNotifier extends StateNotifier<StockItemState> {

final StockRepository stockRepository;

StockItemNotifier(this.stockRepository) : super(StockItemState());

class CounterNotifier extends StateNotifier<CountState> {

CounterNotifier(CountState initialState) : super(initialState);

Notifiers - Method

- fetchStockItems()
- addStockItem(StockItem item)
- updateStockItem(StockItem item)
- deleteStockItem(StockItem item)

**// TODO - Remove interface and refactor**

- incrementCount()
- decrementCount()
- setCount(int newCount)

Repository - Method

- fetchStockItems()
- addStockItem(StockItem item)

**// TODO - Remove interface and refactor**

- fetchStockCounts() **// TODO - Complete**
- updateStockCount(StockCount count) **// TODO - Complete**

Providers

_Not yet completed_

final counterProvider =

StateNotifierProvider.family<CounterNotifier, CountState, int>(

(ref, initialCount) => CounterNotifier(CountState(

quantity: initialCount,

hasChanged: false,

Consumers - UI

_Not yet completed_

class Counter extends ConsumerWidget {

final int initialCount;

const Counter({

super.key,

required this.initialCount,

});

**// Much more to do with the widget build**

### **Mutation Matrix - Mapping the flow of change of the data / UI**

**Key:**

**Bold – State - Local**

Underline – Data - Firestore or Cache

**Mutation**

Carousel

Stocktake List

Stock Item

Stock Count

Dots Decorator / Indicator









Initialisation

displayLocationName

displaySublocation(init)

getPageNumber(init)

populateList(init)

fetchStockItems(init)

mapStockItems(init)

cacheStockItems

displayStockItems(init)

fetchStockCounts(init)

mapStockCounts(init)

cacheStockCounts

displayStockCounts(init)

buildDot(init)









onPageChange

getPageNumber(new)

updateSublocation(new)

displaySublocation(new)

populateList(new)

cache.fetchStockItems(new)

displayStockItems(new)

cache.fetchStockCounts(new)

displayStockCounts(new)

buildDot(new)









onCountChange

_No action_

No action

No action

updateStockCount()

updateStockCounts(change)

displayStockCounts(change)

No action

